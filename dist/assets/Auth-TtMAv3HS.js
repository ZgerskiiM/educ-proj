import{a2 as a}from"./index-BHpa5Asv.js";const c="jwt_token",i="refreshToken",u="expiresAt",l="userRole",p={getToken(){return localStorage.getItem(c)},setTokens(e){e.token&&localStorage.setItem(c,e.token),e.refreshToken&&localStorage.setItem(i,e.refreshToken),e.expiresAt&&localStorage.setItem(u,e.expiresAt)},isAuthenticated(){return!!this.getToken()},decodeToken(e){try{const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(o).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}catch(t){return console.error("Error decoding token",t),null}},async login(e,t){try{const s=(await a.post("/auth/login",{email:e,password:t})).data;localStorage.setItem(c,s.token);const r=this.decodeToken(s.token);if(r&&r.role)console.log("Setting user role from token:",r.role),localStorage.setItem(l,r.role);else try{const n=await this.getUserData();n&&n.role&&localStorage.setItem(l,n.role)}catch(n){console.error("Failed to get user data:",n)}return s}catch(o){throw console.error("Login error:",o),o}},async signup(e,t,o,s){try{return(await a.post("/auth/signup",{firstName:o,email:e,lastName:s,password:t})).data}catch(r){throw console.error("Registration error:",r),r}},async verify(e,t){return(await a.post("/auth/verify",{email:e,verificationCode:t})).data},async resetRequest(e){return(await a.post("/auth/request-password-reset",null,{params:{email:e}})).data},async resetPassword(e,t){return(await a.post("/auth/reset-password",null,{params:{token:e,newPassword:t}})).data},async resend(e){return(await a.post("/auth/resend",null,{params:{email:e}})).data},async getUserData(){try{const e=this.getToken();if(!e)throw new Error("Authentication token is missing");return(await a.get("/users/me",{headers:{Authorization:`Bearer ${e}`}})).data}catch(e){throw console.error("Error fetching user data:",e),e}},hasRole(e){return localStorage.getItem(l)===e},isAdmin(){return this.hasRole("ADMIN")},logout(){localStorage.removeItem(c),localStorage.removeItem(i),localStorage.removeItem(u),localStorage.removeItem(l)}};export{p as A};
