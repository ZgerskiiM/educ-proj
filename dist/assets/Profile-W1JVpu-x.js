import{d as q,u as et,g as V,h as L,C as K,o as u,c as x,f as U,b as f,a as t,q as w,s as N,w as o,m as j,e as $,t as h,F as E,l as at,A as G,H as J,r as a,_ as F,k as Q,I as vt,i as _t,J as gt,K as ht}from"./index-BAaSDoqS.js";import{A as yt}from"./Header-BBPRn6se.js";import{A as xt}from"./AppFooter-Cgy3zGr0.js";const bt={key:0,class:"desktop-buttons mt-2 mb-2 d-flex"},wt={class:"d-flex"},kt={key:0},Ct={key:0,class:"mt-4 d-flex flex-wrap gap-2 justify-center"},Ut={class:"d-flex gap-3"},Vt=q({__name:"ProfileCard",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","logout","error","success"],setup(e,{emit:y}){const{mdAndDown:i,smAndDown:n}=et(),c=at(),d=e,r=y,p=V(!1),v=V({...d.modelValue}),g=V(!1),b=L(()=>G.isAdmin()),I=()=>{c.push("/admin")},_=()=>G.getToken();async function A(){var s,l;try{if(!_())return r("error","Вы не авторизованы"),!1;if(await J.post("/users/update-user",null,{params:{newFirstName:v.value.firstName,newLastName:v.value.lastName}}),O.value&&T.value){const C=new FormData;C.append("image",T.value);const D=await J.post("/users/upload",C,{headers:{"Content-Type":"multipart/form-data"}});D.data&&D.data.imageUrl&&(v.value.imageUrl=D.data.imageUrl)}return r("update:modelValue",{...v.value}),p.value=!1,r("success","Профиль успешно обновлен"),!0}catch(m){const C=((l=(s=m.response)==null?void 0:s.data)==null?void 0:l.message)||"Не удалось обновить профиль";return r("error",C),!1}}const k=L(()=>{if(!d.modelValue.imageUrl)return"/EmptyAvatar.png";try{const s=d.modelValue.imageUrl,l=P(s),m=B(l);return z(m),m}catch{return"/EmptyAvatar.png"}}),z=s=>{const l=new Image;l.src=s},P=s=>!s||s==="null"||s==="undefined"?"/EmptyAvatar.png":s.startsWith("/")?s:!s.startsWith("http://")&&!s.startsWith("https://")?`${J.defaults.baseURL||""}${s}`:s,B=s=>{if(!s)return"/EmptyAvatar.png";if(s.startsWith("/"))return s;let l=s.replace(/https:\/\/https:\/\//g,"https://");l=l.replace(/https:\/\/https\//g,"https://");try{const m=decodeURIComponent(l);return encodeURI(m)}catch{return l}};K(()=>d.modelValue,s=>{p.value||(v.value={...s})},{deep:!0});function R(){v.value={...d.modelValue},p.value=!0}const T=V(null),O=V(!1);function W(s){const l=Array.isArray(s)?s[0]:s;if(l){T.value=l,O.value=!0;const m=new FileReader;m.onload=C=>{C.target&&C.target.result&&(v.value.imageUrl=C.target.result)},m.readAsDataURL(l)}}function lt(){v.value={...d.modelValue},p.value=!1}function nt(){g.value=!1,localStorage.removeItem("token"),localStorage.removeItem("user"),r("logout"),c.push("/login")}return(s,l)=>{const m=a("v-btn"),C=a("v-progress-circular"),D=a("v-row"),st=a("v-img"),rt=a("v-avatar"),X=a("v-col"),H=a("v-list-item-title"),M=a("v-list-item"),it=a("v-list"),Y=a("v-text-field"),ct=a("v-file-input"),ut=a("v-form"),Z=a("v-card-text"),tt=a("v-card"),dt=a("v-card-title"),mt=a("v-spacer"),ft=a("v-card-actions"),pt=a("v-dialog");return u(),x(E,null,[!U(n)&&!p.value?(u(),x("div",bt,[f("div",wt,[t(m,{class:"profile-card--button font-weight-light text-none",variant:"flat",color:"#333132",text:"Редактировать",onClick:R}),t(m,{class:"profile-card--button font-weight-light text-none ml-3",color:"error",variant:"outlined",text:"Выйти",onClick:l[0]||(l[0]=S=>g.value=!0)}),b.value?(u(),w(m,{key:0,class:"profile-card--button font-weight-light text-none ml-3",color:"warning",variant:"outlined",text:"Админка",onClick:I})):N("",!0)]),t(m,{class:"profile-card--button font-weight-light text-none ml-auto",color:"primary",variant:"outlined",text:"Связаться с поддержкой",href:"https://t.me/babichbaker_course",target:"_blank"})])):N("",!0),t(tt,{class:"profile--card mb-5 rounded-lg"},{default:o(()=>[t(Z,null,{default:o(()=>[t(D,null,{default:o(()=>[t(X,{cols:"12",md:"3",lg:"3",xl:"2",class:j(["d-flex mr-0 pr-0 pl-0 ml-0",{"justify-center align-center flex-column":U(n),"align-self-start flex-row":!U(n)}])},{default:o(()=>[t(rt,{size:"160",class:j(["mb-2 mt-4",{"justify-center align-center flex-column ":U(n),"align-self-start ml-4":!U(n)}])},{default:o(()=>[t(st,{src:k.value,alt:"Фото профиля",fallback:"/EmptyAvatar.png",cover:"",width:160,height:160,"aspect-ratio":1},{placeholder:o(()=>[t(D,{class:"fill-height ma-0",align:"center",justify:"center"},{default:o(()=>[t(C,{indeterminate:"",color:"primary"})]),_:1})]),_:1},8,["src"])]),_:1},8,["class"])]),_:1},8,["class"]),t(X,{cols:"12",md:"8",lg:"8",xl:"9",class:j(["d-flex align-center",{"pl-6":!U(n)}])},{default:o(()=>[p.value?(u(),w(ut,{key:1},{default:o(()=>[l[6]||(l[6]=f("div",{class:"d-flex justify-space-between align-center mb-4"},[f("div",{class:"profile-card--text"},"Редактирование профиля")],-1)),t(Y,{modelValue:v.value.firstName,"onUpdate:modelValue":l[2]||(l[2]=S=>v.value.firstName=S),label:"Имя",variant:"outlined",class:"mb-1",density:"compact"},null,8,["modelValue"]),t(Y,{modelValue:v.value.lastName,"onUpdate:modelValue":l[3]||(l[3]=S=>v.value.lastName=S),label:"Фамилия",variant:"outlined",class:"mb-1",density:"compact"},null,8,["modelValue"]),t(ct,{label:"Изменить фото",accept:"image/*","prepend-icon":"",variant:"outlined",density:"compact","hide-details":"",class:j(["mb-3",{"w-100 h-25":U(n),"max-width-250":!U(n)}]),style:{"max-height":"500px"},"onUpdate:modelValue":W},null,8,["class"]),f("div",Ut,[t(m,{class:"profile-card--button font-weight-light text-none",color:"#333132",text:"Сохранить",onClick:A}),t(m,{class:"ml-2 profile-card--button font-weight-light text-none",color:"grey",variant:"outlined",text:"Отмена",onClick:lt})])]),_:1})):(u(),x("div",kt,[t(it,{color:"#FAFAFA",class:j({"pa-0 list-left-aligned":!U(n)})},{default:o(()=>[t(M,{class:"mb-0 pb-0"},{default:o(()=>[t(H,{class:"font-weight-regular"},{default:o(()=>[$(h(e.modelValue.firstName),1)]),_:1})]),_:1}),t(M,{class:"mt-0 pt-0"},{default:o(()=>[t(H,{class:"font-weight-regular mt-0 pt-0"},{default:o(()=>[$(h(e.modelValue.lastName),1)]),_:1})]),_:1}),t(M,{class:"mail--text"},{default:o(()=>[t(H,{class:"mail--text font-weight-light"},{default:o(()=>[$(h(e.modelValue.email),1)]),_:1})]),_:1})]),_:1},8,["class"]),U(n)?(u(),x("div",Ct,[t(m,{class:"profile-card--button font-weight-light text-none",color:"#31331","prepend-icon":"mdi-pencil",variant:"outlined",text:"Редактировать",onClick:R}),t(m,{class:"profile-card--button font-weight-light text-none",color:"error",variant:"outlined",text:"Выйти","prepend-icon":"mdi-logout",onClick:l[1]||(l[1]=S=>g.value=!0)}),b.value?(u(),w(m,{key:0,class:"profile-card--button font-weight-light text-none",color:"warning",variant:"outlined",text:"Админка","prepend-icon":"mdi-shield-account",onClick:I})):N("",!0),t(m,{class:"profile-card--button font-weight-light text-none",color:"primary",variant:"outlined",text:"Поддержка","prepend-icon":"mdi-help-circle",href:"https://t.me/babichbaker_course",target:"_blank"})])):N("",!0)]))]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),t(pt,{modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=S=>g.value=S),"max-width":"400"},{default:o(()=>[t(tt,null,{default:o(()=>[t(dt,null,{default:o(()=>l[7]||(l[7]=[$("Подтверждение")])),_:1}),t(Z,{class:"font-weight-light"},{default:o(()=>l[8]||(l[8]=[$(" Вы действительно хотите выйти из аккаунта? ")])),_:1}),t(ft,null,{default:o(()=>[t(mt),t(m,{class:"profile-card--button font-weight-light text-none",variant:"outlined",text:"Отмена",onClick:l[4]||(l[4]=S=>g.value=!1)}),t(m,{variant:"outlined",class:"profile-card--button font-weight-light text-none",color:"error",text:"Выйти",onClick:nt})]),_:1})]),_:1})]),_:1},8,["modelValue"]),N("",!0)],64)}}}),$t=F(Vt,[["__scopeId","data-v-9c37cc11"]]),At={class:"text-caption text-truncate-2 course-description"},St=q({__name:"CourseCard",props:{course:{type:Object,required:!0}},emits:["navigate"],setup(e,{emit:y}){const i=e,n=at();function c(){localStorage.setItem(`original_course_image_${i.course.id}`,i.course.imageUrl),n.push(`/course/${i.course.id}`)}return(d,r)=>{const p=a("v-img"),v=a("v-card-title"),g=a("v-card-text"),b=a("v-btn"),I=a("v-card-actions"),_=a("v-card");return u(),w(_,{rounded:"lg",elevation:"1",class:"cabinet-card d-flex flex-column"},{default:o(()=>[t(p,{src:e.course.imageUrl,class:"mr-3 ml-3 mt-3 rounded-lg",alt:e.course.title},null,8,["src","alt"]),t(v,{class:"font-weight-medium"},{default:o(()=>[$(h(e.course.title),1)]),_:1}),t(g,{class:"py-1"},{default:o(()=>[r[0]||(r[0]=f("div",{class:"d-flex align-center mb-2"},null,-1)),f("div",At,h(e.course.description),1)]),_:1}),t(I,{class:"mt-auto"},{default:o(()=>[t(b,{variant:"flat",block:"",class:"card-btn-text text-none font-weight-light w-50",color:"#333132",onClick:c},{default:o(()=>[$(h(e.course.progress>0?"Продолжить":"Приступить"),1)]),_:1})]),_:1})]),_:1})}}}),Nt=F(St,[["__scopeId","data-v-15801b7f"]]),It={class:"filter-tabs mb-4"},Dt={class:"flexible-filter-tabs"},jt=q({__name:"CourseFilterTabs",props:{modelValue:{type:String,required:!0},options:{type:Array,required:!0}},emits:["update:modelValue"],setup(e){return(y,i)=>{const n=a("v-btn");return u(),x("div",It,[f("div",Dt,[(u(!0),x(E,null,Q(e.options,c=>(u(),w(n,{key:c.value,class:j(["filter-tab-btn font-weight-light",{"active-tab":e.modelValue===c.value}]),variant:"outlined",onClick:d=>y.$emit("update:modelValue",c.value)},{default:o(()=>[$(h(c.label),1)]),_:2},1032,["class","onClick"]))),128))])])}}}),Ft=F(jt,[["__scopeId","data-v-42191f72"]]),Tt={class:"mb-2"},qt={class:"mb-6 text-grey"},Et={key:0,class:"tooltip-wrapper"},Rt=q({__name:"EmptyState",props:{icon:{type:String,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},actionText:{type:String,default:""},actionRoute:{type:String,default:""},actionColor:{type:String,default:"#333132"}},setup(e){return(y,i)=>{const n=a("v-icon"),c=a("v-tooltip"),d=a("v-btn"),r=a("v-card");return u(),w(r,{rounded:"lg",elevation:"1",class:"empty-card d-flex flex-column align-center justify-center"},{default:o(()=>[t(n,{icon:e.icon,size:"64",color:"grey-lighten-1",class:"mb-4"},null,8,["icon"]),f("div",Tt,h(e.title),1),f("div",qt,h(e.description),1),e.actionText?(u(),x("div",Et,[t(c,{location:"bottom",text:"Скоро будет доступно"},{activator:o(({props:p})=>[f("div",vt(p,{class:"w-100 h-100 position-absolute"}),null,16)]),_:1}),t(d,{class:"font-weight-light text-none",color:e.actionColor,to:e.actionRoute,disabled:""},{default:o(()=>[$(h(e.actionText),1)]),_:1},8,["color","to"])])):N("",!0)]),_:1})}}}),ot=F(Rt,[["__scopeId","data-v-90409ea4"]]),Ot={class:"mb-8"},Lt={class:"d-flex justify-space-between align-center mb-4"},zt={class:"font-weight-regular"},Pt={key:2,class:"text-center py-8 mt-0 pt-0 font-weight-light"},Bt={__name:"index",props:{title:{type:String,default:"Мои курсы"},courses:{type:Array,required:!0},filterValue:{type:String,required:!0},filterOptions:{type:Array,required:!0},emptyState:{type:Object,default:()=>({icon:"mdi-school-outline",title:"У вас пока нет курсов",description:"Вы можете найти интересные курсы в нашем каталоге",actionText:"Перейти в каталог",actionRoute:"/catalog",actionDisabled:{type:Boolean,default:!1}})}},emits:["update:filter-value"],setup(e,{emit:y}){const i=e,n=y,c=V(i.filterValue);K(()=>i.filterValue,r=>{c.value=r}),K(c,r=>{n("update:filter-value",r)});const d=L(()=>{switch(c.value){case"not-started":return i.courses.filter(r=>r.progress===0);case"in-progress":return i.courses.filter(r=>r.progress>0&&r.progress<100);case"completed":return i.courses.filter(r=>r.progress===100);default:return i.courses}});return(r,p)=>{const v=a("v-col"),g=a("v-row");return u(),x("div",Ot,[f("div",Lt,[f("h2",zt,h(e.title),1)]),e.filterOptions&&e.filterOptions.length?(u(),w(Ft,{key:0,modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=b=>c.value=b),options:e.filterOptions},null,8,["modelValue","options"])):N("",!0),d.value.length>0?(u(),w(g,{key:1},{default:o(()=>[(u(!0),x(E,null,Q(d.value,b=>(u(),w(v,{key:b.id,cols:"12",sm:"6",lg:"4"},{default:o(()=>[t(Nt,{course:b},null,8,["course"])]),_:2},1024))),128))]),_:1})):(u(),x("div",Pt,[t(ot,{icon:e.emptyState.icon,title:e.emptyState.title,description:e.emptyState.description,"action-text":e.emptyState.actionText,"action-route":e.emptyState.actionRoute},null,8,["icon","title","description","action-text","action-route"])]))])}}},Wt={class:"position-relative"},Ht={class:"d-flex align-center mb-2"},Mt={class:"font-weight-light"},Jt={class:"text-caption"},Kt=q({__name:"CertificateCard",props:{certificate:{type:Object,required:!0}},emits:["download","open"],setup(e){return(y,i)=>{const n=a("v-img"),c=a("v-card-title"),d=a("v-icon"),r=a("v-card-text"),p=a("v-btn"),v=a("v-card-actions"),g=a("v-card");return u(),w(g,{rounded:"lg",elevation:"1",class:"cabinet-card d-flex flex-column overflow-x"},{default:o(()=>[f("div",Wt,[t(n,{src:e.certificate.image,height:"250",cover:"",class:"rounded-t-lg bg-grey-lighten-4",alt:`Сертификат: ${e.certificate.courseName}`},null,8,["src","alt"]),i[1]||(i[1]=f("div",{class:"certificate-badge"},null,-1))]),t(c,{class:"text-truncate"},{default:o(()=>[$(h(e.certificate.courseName),1)]),_:1}),t(r,{class:"py-1"},{default:o(()=>[f("div",Ht,[t(d,{icon:"mdi-calendar",size:"small",class:"mr-1"}),f("span",Mt,"Выдан: "+h(e.certificate.issueDate),1)]),f("div",Jt,[t(d,{icon:"mdi-certificate",size:"small",class:"mr-1"}),i[2]||(i[2]=f("span",null,"Профессиональный сертификат",-1))])]),_:1}),t(v,{class:"mt-auto d-flex align-center justify-center ml-2 mr-2"},{default:o(()=>[t(p,{color:"#333132",variant:"outlined","prepend-icon":"mdi-download",class:"card-btn-text text-none font-weight-regular w-100",onClick:i[0]||(i[0]=b=>y.$emit("download",e.certificate.id))},{default:o(()=>i[3]||(i[3]=[$(" Скачать ")])),_:1})]),_:1})]),_:1})}}}),Gt=F(Kt,[["__scopeId","data-v-f60dc4a1"]]),Qt={class:"d-flex justify-space-between align-center mb-8"},Xt={class:"font-weight-regular"},Yt={__name:"index",props:{title:{type:String,default:"Мои сертификаты"},certificates:{type:Array,required:!0},emptyState:{type:Object,default:()=>({icon:"mdi-certificate-outline",title:"У вас пока нет сертификатов",description:"Завершите курс, чтобы получить сертификат"})}},setup(e){const y=n=>{console.log("Скачивание сертификата:",n)},i=n=>{console.log("Открытие сертификата:",n)};return(n,c)=>{const d=a("v-col"),r=a("v-row");return u(),x("div",null,[f("div",Qt,[f("h2",Xt,h(e.title),1)]),t(r,null,{default:o(()=>[(u(!0),x(E,null,Q(e.certificates,p=>(u(),w(d,{key:p.id,cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Gt,{certificate:p,onDownload:y,onOpen:i},null,8,["certificate"])]),_:2},1024))),128)),e.certificates.length===0?(u(),w(d,{key:0,cols:"12",class:"text-center py-8 mt-0 pt-0 font-weight-light"},{default:o(()=>[t(ot,{icon:e.emptyState.icon,title:e.emptyState.title,description:e.emptyState.description},null,8,["icon","title","description"])]),_:1})):N("",!0)]),_:1})])}}},Zt={__name:"Profile",setup(e){const{mdAndDown:y}=et(),i=V("all"),n=V(!1),c=V({firstName:"",lastName:"",email:"",imageUrl:""}),d=V([]);async function r(){try{if(n.value=!0,!G.getToken()){d.value=[];return}const A=await gt();d.value=A.map(k=>({id:k.id,title:k.title,imageUrl:k.imageUrl||"/public/main--menu3.png",progress:k.progress||0,lessonsCompleted:k.lessonsCompleted||0,totalLessons:k.totalLessons||0,certificateAvailable:k.certificateAvailable||!1}))}catch(_){console.error("Ошибка при получении курсов пользователя:",_),d.value=[]}finally{n.value=!1}}async function p(){try{n.value=!0;const _=await ht();c.value={firstName:_.firstName||"",lastName:_.lastName||"",email:_.email||"",imageUrl:_.imageUrl||"/EmptyAvatar.png"}}catch(_){console.error("Ошибка при получении данных пользователя:",_)}finally{n.value=!1}}_t(()=>{p(),r()});const v=V("");function g(){c.value={firstName:"",lastName:"",email:"",imageUrl:""},localStorage.removeItem("jwt_token")}const b=[{value:"all",label:"Все курсы"},{value:"not-started",label:"Не начатые"},{value:"in-progress",label:"В процессе"},{value:"completed",label:"Завершенные"}],I=L(()=>{let _="";switch(i.value){case"not-started":_="У вас нет не начатых курсов";break;case"in-progress":_="У вас нет курсов в процессе";break;case"completed":_="У вас нет завершенных курсов";break;default:_="У вас пока нет курсов"}return{icon:"mdi-book-outline",title:_,description:"Выберите другой фильтр или перейдите в каталог",actionText:"Перейти в каталог",actionRoute:"/catalog"}});return(_,A)=>{const k=a("v-col"),z=a("v-row"),P=a("v-progress-circular"),B=a("v-overlay"),R=a("v-container"),T=a("v-main"),O=a("v-app");return u(),x(E,null,[t(yt),t(O,null,{default:o(()=>[t(T,null,{default:o(()=>[t(R,{width:U(y)?"100vw":"60vw"},{default:o(()=>[t(z,{class:"mb-2"},{default:o(()=>[t(k,{cols:"12"},{default:o(()=>A[1]||(A[1]=[f("h1",{class:"font-weight-medium mt-4"},"Профиль",-1)])),_:1})]),_:1}),t(B,{"model-value":n.value,contained:"",class:"align-center justify-center"},{default:o(()=>[t(P,{indeterminate:"",size:"64"})]),_:1},8,["model-value"]),t($t,{modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=W=>c.value=W),class:"mb-8",onLogout:g},null,8,["modelValue"]),t(Bt,{courses:d.value,"filter-value":i.value,"filter-options":b,"empty-state":I.value},null,8,["courses","filter-value","empty-state"]),t(Yt,{certificates:v.value},null,8,["certificates"])]),_:1},8,["width"]),t(xt)]),_:1})]),_:1})],64)}}},oe=F(Zt,[["__scopeId","data-v-de44a858"]]);export{oe as default};
