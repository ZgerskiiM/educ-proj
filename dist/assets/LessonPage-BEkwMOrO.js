import{d as G,c as I,r as c,p as J,z as Q,o as r,b as y,f as u,B as X,s as K,C as H,k as z,i as C,w as n,g as a,t as T,n as Y,e as v,j as Z,m as U,_ as ee,u as te,x as se,h as V,F as q,q as le,l as oe}from"./index-D_oD8h-s.js";import{H as ne,A as ae}from"./AppFooter-4xhL_aov.js";import{c as W}from"./courseService-D1sgdsVc.js";import{c as re}from"./courseUserService-BmvocA1L.js";const ue=["poster"],ie=["src","type"],ve={class:"video-progress"},ce={class:"controls-main"},de={class:"volume-control"},me={class:"time-display"},pe=G({__name:"VideoPlayer",props:{videoUrl:{type:String,default:""},posterImage:{type:String,default:""}},setup(B){const w=B,E=I(()=>{if(!w.videoUrl)return"video/avi";switch(w.videoUrl.split(".").pop().toLowerCase()){case"mp4":return"video/mp4";case"webm":return"video/webm";case"ogg":return"video/ogg";case"avi":return"video/avi";case"mov":return"video/quicktime";default:return"video/mp4"}}),D=o=>{if(!o)return"/public/default-lesson.jpg";let t=o.replace(/https:\/\/https:\/\//g,"https://");return t=t.replace(/https:\/\/https\//g,"https://"),t},l=c(null),_=c(null),h=c(!1),P=c(0),S=c(0),f=c(0),i=c(1),b=c(!1),p=c(!1),k=c(!0);let x=null;const m=()=>{k.value=!0,x&&clearTimeout(x),x=setTimeout(()=>{h.value&&(k.value=!1)},3e3)},F=()=>{l.value&&(h.value?l.value.pause():l.value.play(),h.value=!h.value,m())},$=()=>{l.value&&(P.value=l.value.currentTime,f.value=P.value/S.value*100)},A=()=>{l.value&&(S.value=l.value.duration)},R=()=>{if(!l.value)return;const o=f.value/100*S.value;l.value.currentTime=o},M=()=>{l.value&&(l.value.volume=i.value,b.value=i.value===0)},j=()=>{l.value&&(b.value?(b.value=!1,i.value=i.value===0?1:i.value,l.value.volume=i.value):(b.value=!0,l.value.volume=0))},N=()=>{_.value&&(document.fullscreenElement?(document.exitFullscreen(),p.value=!1):(_.value.requestFullscreen(),p.value=!0))},s=()=>{p.value=!!document.fullscreenElement},e=o=>{const t=Math.floor(o/60),d=Math.floor(o%60);return`${t}:${d<10?"0":""}${d}`},g=o=>{(document.activeElement===l.value||document.activeElement===_.value||p.value)&&(o.code==="Space"?(F(),o.preventDefault()):o.code==="ArrowRight"?(l.value&&(l.value.currentTime+=10),m()):o.code==="ArrowLeft"?(l.value&&(l.value.currentTime-=10),m()):o.code==="KeyM"?(j(),m()):o.code==="KeyF"&&(N(),m()))};return J(()=>{window.addEventListener("keydown",g),document.addEventListener("fullscreenchange",s),_.value&&_.value.addEventListener("mousemove",m),l.value&&(l.value.volume=i.value)}),Q(()=>{window.removeEventListener("keydown",g),document.removeEventListener("fullscreenchange",s),_.value&&_.value.removeEventListener("mousemove",m),x&&clearTimeout(x)}),(o,t)=>{const d=U("v-icon");return r(),y("div",{class:"video-container mb-5",ref_key:"videoContainer",ref:_},[u("video",{ref_key:"videoPlayer",ref:l,onTimeupdate:$,onLoadedmetadata:A,onEnded:t[0]||(t[0]=L=>h.value=!1),onClick:F,poster:B.posterImage},[u("source",{src:D(B.videoUrl),type:E.value},null,8,ie)],40,ue),u("div",{class:Y(["video-controls",{"controls-visible":k.value}])},[u("div",ve,[u("div",{class:"progress-bar",style:X({width:`${f.value}%`})},null,4),K(u("input",{type:"range",class:"progress-seek",min:"0",max:"100",step:"0.1","onUpdate:modelValue":t[1]||(t[1]=L=>f.value=L),onInput:R},null,544),[[H,f.value]])]),u("div",ce,[u("button",{class:"control-btn",onClick:z(F,["stop"])},[h.value?(r(),C(d,{key:1},{default:n(()=>t[4]||(t[4]=[a("mdi-pause")])),_:1})):(r(),C(d,{key:0},{default:n(()=>t[3]||(t[3]=[a("mdi-play")])),_:1}))]),u("div",de,[u("button",{class:"control-btn",onClick:z(j,["stop"])},[b.value?(r(),C(d,{key:0},{default:n(()=>t[5]||(t[5]=[a("mdi-volume-off")])),_:1})):i.value<.5?(r(),C(d,{key:1},{default:n(()=>t[6]||(t[6]=[a("mdi-volume-low")])),_:1})):(r(),C(d,{key:2},{default:n(()=>t[7]||(t[7]=[a("mdi-volume-high")])),_:1}))]),K(u("input",{type:"range",class:"volume-slider",min:"0",max:"1",step:"0.1","onUpdate:modelValue":t[2]||(t[2]=L=>i.value=L),onInput:M},null,544),[[H,i.value]])]),u("div",me,T(e(P.value))+" / "+T(e(S.value)),1),u("button",{class:"control-btn fullscreen-btn",onClick:z(N,["stop"])},[p.value?(r(),C(d,{key:0},{default:n(()=>t[8]||(t[8]=[a("mdi-fullscreen-exit")])),_:1})):(r(),C(d,{key:1},{default:n(()=>t[9]||(t[9]=[a("mdi-fullscreen")])),_:1}))])])],2),h.value?Z("",!0):(r(),y("div",{key:0,class:"big-play-button",onClick:z(F,["stop"])},[v(d,{size:"64"},{default:n(()=>t[10]||(t[10]=[a("mdi-play")])),_:1})]))],512)}}}),fe=ee(pe,[["__scopeId","data-v-2135aa7c"]]),ge={class:"page-wrapper"},ye={key:0,class:"d-flex justify-center my-5"},_e={key:1,class:"error-message"},be={key:2},ke={key:0,class:"breadcrumbs-container"},we={key:1,class:"back-button-container pt-4 pb-2 pl-0 ml-0"},he={class:"content-wrapper flex-column"},xe={class:"video-block mb-0 pt-0"},$e={class:"font-weight-medium mb-3"},Ie={class:"nav--buttons pt-0 mt-0 mb-1 d-flex justify-end"},Pe=G({__name:"LessonPage",setup(B){const{mdAndDown:w}=te(),E=le(),D=oe(),l=c(null),_=c(""),h=s=>{if(!s)return"/public/default-lesson.jpg";let e=s.replace(/https:\/\/https:\/\//g,"https://");return e=e.replace(/https:\/\/https\//g,"https://"),e},P=async()=>{let e=0;for(;e<3;)try{f.value=!0;const g=await W.getLessonDetails(x.value);return b.value=g,g}catch(g){if(e++,console.error(`Ошибка при загрузке урока (попытка ${e}/3):`,g),e>=3)throw i.value="Не удалось загрузить урок. Пожалуйста, проверьте подключение к интернету и попробуйте снова.",g;await new Promise(o=>setTimeout(o,1e3*e))}finally{f.value=!1}},S=async s=>{if(s){f.value=!0,i.value="";try{const e=await re.fetchCourseWithBlocks(s);_.value=e.courseTitle||"Курс без названия",l.value=e.imageUrl||null}catch(e){console.error("Ошибка при загрузке курса:",e),i.value="Не удалось загрузить данные курса. Пожалуйста, попробуйте позже."}finally{f.value=!1}}},f=c(!0),i=c(""),b=c({lessonTitle:"",videoUrl:"",description:"",sheetUrl:"",imageUrl:""}),p=I(()=>E.params.courseId),k=I(()=>E.params.keysId),x=I(()=>E.params.lessonId),m=c([]),F=async()=>{try{const s=await W.getBlockLessons(k.value);m.value=s.lessons||[]}catch(s){console.error("Ошибка при загрузке списка уроков:",s)}},$=I(()=>{const s=x.value?String(x.value):null;return m.value.findIndex(e=>{const g=e.id?String(e.id):null,o=e.lessonId?String(e.lessonId):null;return g===s||o===s})}),A=I(()=>{if($.value>0){const s=m.value[$.value-1];return s.id||s.lessonId}return null}),R=I(()=>{if($.value<m.value.length-1&&$.value!==-1){const s=m.value[$.value+1];return s.id||s.lessonId}return null}),M=I(()=>$.value!==-1&&$.value===m.value.length-1),j=()=>{A.value&&D.push(`/course/${p.value}/blocks/${k.value}/lessons/${A.value}`)},N=()=>{R.value?D.push(`/course/${p.value}/blocks/${k.value}/lessons/${R.value}`):M.value&&D.push(`/course/${p.value}/blocks/${k.value}`)};return J(async()=>{await Promise.all([P(),F(),S(p.value)])}),se(()=>E.params.lessonId,(s,e)=>{s&&s!==e&&(b.value={lessonTitle:"",videoUrl:"",description:"",sheetUrl:""},f.value=!0,P())}),(s,e)=>{const g=U("v-progress-circular"),o=U("v-breadcrumbs-item"),t=U("v-breadcrumbs"),d=U("v-btn"),L=U("v-icon"),O=U("v-container");return r(),y("div",ge,[v(ne),v(O,{fluid:"",class:"content-container px-6 pt-2",width:V(w)?"100vw":"60vw"},{default:n(()=>[f.value?(r(),y("div",ye,[v(g,{indeterminate:"",color:"#F48A21"})])):i.value?(r(),y("div",_e,T(i.value),1)):(r(),y("div",be,[V(w)?(r(),y("div",we,[v(d,{variant:"outlined",density:"comfortable",to:`/course/${p.value}/blocks/${k.value}`,class:"back-button text-none"},{default:n(()=>e[3]||(e[3]=[a(" К урокам ")])),_:1},8,["to"])])):(r(),y("div",ke,[v(t,{class:"mb-1 pl-0 font-weight-light",color:"#F48A21"},{default:n(()=>[v(o,{to:"/lk"},{default:n(()=>e[1]||(e[1]=[a("Профиль")])),_:1}),v(o,{to:`/course/${p.value}`},{default:n(()=>[a(T(_.value),1)]),_:1},8,["to"]),v(o,{to:`/course/${p.value}/blocks/${k.value}`},{default:n(()=>e[2]||(e[2]=[a("Уроки")])),_:1},8,["to"]),v(o,{disabled:""},{default:n(()=>[a(T(b.value.lessonTitle),1)]),_:1})]),_:1})])),u("div",he,[u("div",xe,[u("h2",$e,T(b.value.lessonTitle),1),v(fe,{"video-url":b.value.videoUrl,"poster-image":h(l.value)},null,8,["video-url","poster-image"]),u("div",Ie,[v(d,{class:"text-none rounded-lg",width:V(w)?"40vw":"regular",variant:"outlined",onClick:j,disabled:!A.value},{default:n(()=>[V(w)?(r(),y(q,{key:0},[v(L,null,{default:n(()=>e[4]||(e[4]=[a("mdi-arrow-left")])),_:1}),e[5]||(e[5]=a(" Предыдущий "))],64)):(r(),y(q,{key:1},[a(" Предыдущий урок ")],64))]),_:1},8,["width","disabled"]),v(d,{class:"text-none rounded-lg ml-4",width:V(w)?"40vw":"regular",variant:"outlined",color:"#333132",onClick:e[0]||(e[0]=Te=>N())},{default:n(()=>[V(w)?(r(),y(q,{key:0},[a(T(M.value?"Завершить":"Следующий")+" ",1),v(L,null,{default:n(()=>e[6]||(e[6]=[a("mdi-arrow-right")])),_:1})],64)):(r(),y(q,{key:1},[a(T(M.value?"Завершить блок":"Следующий урок"),1)],64))]),_:1},8,["width"])])])])]))]),_:1},8,["width"]),v(ae)])}}});export{Pe as default};
