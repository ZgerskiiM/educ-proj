import{d as q,u as z,r as u,a as g,p as E,c as x,o as C,b as K,e as r,w as y,f as R,g as V,h as b,i as W,t as L,j as Z,k as F,n as G,l as H,q as J,m,A as O,_ as Q}from"./index-BJbwW3MX.js";import{A as X,_ as Y}from"./AuthMobileImage.vue_vue_type_script_setup_true_lang-DTtGt4hO.js";const ee={class:"page-container"},te=q({__name:"rPassword",setup(se){const{mdAndDown:S,smAndUp:_}=z(),T=H(),A=J(),f=u(!1),w=u(!1),i=u(""),v=u(!1),p=u(""),t=g({password:"",confirmPassword:""}),n=g({password:""}),a=g({text:"",type:"info"});E(()=>{var e;p.value=((e=A.query.token)==null?void 0:e.toString())||"",p.value||(a.text="Ссылка недействительна. Запросите восстановление пароля заново.",a.type="error")});const P=x({get:()=>t.password,set:e=>{t.password=e.replace(/\s+/g,""),n.password=""}}),D=x({get:()=>t.confirmPassword,set:e=>{t.confirmPassword=e.replace(/\s+/g,""),c()}}),h=e=>{(e.key===" "||e.key==="Spacebar")&&e.preventDefault()},I=e=>{e.preventDefault();const o=(e.clipboardData||window.clipboardData).getData("text").replace(/\s+/g,"");t.password=o,n.password=""},B=e=>{e.preventDefault();const o=(e.clipboardData||window.clipboardData).getData("text").replace(/\s+/g,"");t.confirmPassword=o,c()},k=()=>{if(n.password="",!!t.password){if(t.password.length<8){n.password="Пароль должен содержать не менее 8 символов";return}if(!/[a-zA-Z]/.test(t.password)){n.password="Пароль должен содержать латинские буквы";return}if(!/\d/.test(t.password)){n.password="Пароль должен содержать цифры";return}if(!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(t.password)){n.password="Пароль должен содержать специальные символы";return}c()}},c=()=>{t.confirmPassword&&t.password!==t.confirmPassword?i.value="Пароли не совпадают":i.value=""},$=async()=>{var e,s,l;if(!p.value){a.text="Отсутствует токен для сброса пароля. Запросите восстановление пароля заново.",a.type="error";return}if(k(),c(),!(n.password||i.value)){v.value=!0,a.text="";try{await O.resetPassword(p.value,t.password),a.text="Пароль успешно изменен!",a.type="success",setTimeout(()=>{T.push("/login")},2e3)}catch(o){console.error("Ошибка при изменении пароля:",o),((e=o.response)==null?void 0:e.status)===400?a.text="Ссылка для восстановления пароля недействительна или срок её действия истек.":(l=(s=o.response)==null?void 0:s.data)!=null&&l.message?a.text=o.response.data.message:a.text="Произошла ошибка при смене пароля. Попробуйте запросить новую ссылку.",a.type="error"}finally{v.value=!1}}},M=x(()=>!t.password||!t.confirmPassword||t.password!==t.confirmPassword||!!n.password||!!i.value||!p.value||v.value);return(e,s)=>{const l=m("v-card-title"),o=m("v-text-field"),N=m("v-alert"),U=m("v-btn"),j=m("v-container");return C(),K("div",ee,[r(X),r(j,{class:"main-container"},{default:y(()=>[R("form",{onSubmit:F($,["prevent"]),class:G(["align-md-center d-flex flex-column",b(S)?"w-66":"w-50"])},[r(Y),r(l,{class:"align-md-center justify-center d-flex pl-0 pb-0 mb-3 font-weight-regular"},{default:y(()=>s[5]||(s[5]=[V(" Установка нового пароля ")])),_:1}),r(o,{class:"w-100 mb-0 font-weight-light",label:"Новый пароль",hint:"Не менее 8 знаков: латинские буквы, цифры, спецсимволы","persistent-hint":"",density:b(_)?"comfortable":"compact",variant:"outlined","append-inner-icon":f.value?"mdi-eye-off":"mdi-eye",modelValue:P.value,"onUpdate:modelValue":s[0]||(s[0]=d=>P.value=d),type:f.value?"text":"password","onClick:appendInner":s[1]||(s[1]=d=>f.value=!f.value),"error-messages":n.password,onInput:k,onKeydown:h,onPaste:I},null,8,["density","append-inner-icon","modelValue","type","error-messages"]),r(o,{class:"w-100 mb-3 font-weight-light mt-3",label:"Повторите пароль",variant:"outlined",density:b(_)?"comfortable":"compact","append-inner-icon":w.value?"mdi-eye-off":"mdi-eye",modelValue:D.value,"onUpdate:modelValue":s[2]||(s[2]=d=>D.value=d),type:w.value?"text":"password","onClick:appendInner":s[3]||(s[3]=d=>w.value=!w.value),"error-messages":i.value,onInput:c,onKeydown:h,onPaste:B},null,8,["density","append-inner-icon","modelValue","type","error-messages"]),a.text?(C(),W(N,{key:0,type:a.type,variant:"tonal",closable:"",class:"mb-3 w-100","onClick:close":s[4]||(s[4]=d=>a.text="")},{default:y(()=>[V(L(a.text),1)]),_:1},8,["type"])):Z("",!0),r(U,{class:"text-none mb-2 w-100 font-weight-thin",type:"submit",text:"Сохранить новый пароль",disabled:M.value,loading:v.value,flat:""},null,8,["disabled","loading"])],34)]),_:1})])}}}),ne=Q(te,[["__scopeId","data-v-227a798f"]]);export{ne as default};
