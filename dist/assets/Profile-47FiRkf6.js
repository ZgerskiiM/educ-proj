import{_ as N,u as et,l as ft,r as w,x as M,c as Q,m as o,o as u,b as x,h as U,f as d,e as t,w as e,g as m,j as A,n as j,i as k,t as g,F as I,G as J,A as K,y as X,H as vt,p as pt,I as _t}from"./index-QKPnfKcf.js";import{H as gt,A as bt}from"./AppFooter-OZn1cCuk.js";const yt={key:0,class:"desktop-buttons mt-2 mb-2 d-flex"},ht={class:"d-flex"},xt={key:0},wt={key:0,class:"mt-4 d-flex justify-end"},kt={class:"d-flex gap-3"},G="https://babichschool.ru:8080",Vt={__name:"ProfileCard",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","logout"],setup(a,{emit:b}){const{mdAndDown:n}=et(),f=ft(),i=a,v=b,s=w(!1),r=w({...i.modelValue}),_=w(!1),S=()=>K.getToken();function $(c){c.target.src="/default-avatar.jpg"}async function D(){try{const c=S();if(!c){alert("Вы не авторизованы");return}if(await J({method:"POST",url:`${G}/users/update-user`,params:{newFirstName:r.value.firstName,newLastName:r.value.lastName},headers:{Authorization:`Bearer ${c}`}}),T.value&&y.value){const l=new FormData;l.append("image",y.value);const h=await J.post(`${G}/users/upload`,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${c}`}});r.value.imageUrl=h.data.imageUrl}v("update:modelValue",{...r.value}),s.value=!1,alert("Профиль успешно обновлен")}catch(c){console.error("Ошибка при обновлении профиля:",c),alert("Не удалось обновить профиль")}}const F=c=>c?c.startsWith("/")?`${G}${c}`:!c.startsWith("http://")&&!c.startsWith("https://")?`http://${c}`:c:"/default-avatar.jpg",p=c=>{if(!c)return"/public/default-lesson.jpg";let l=c.replace(/https:\/\/https:\/\//g,"https://");return l=l.replace(/https:\/\/https\//g,"https://"),l};M(()=>i.modelValue,c=>{s.value||(r.value={...c})},{deep:!0});function C(){r.value={...i.modelValue},s.value=!0}const y=w(null),T=w(!1);function E(c){if(c){y.value=c,T.value=!0;const l=new FileReader;l.onload=h=>{r.value.imageUrl=h.target.result},l.readAsDataURL(c)}}function q(){r.value={...i.modelValue},s.value=!1}const O=w(!1),L=Q(()=>O.value||!i.modelValue.imageUrl?"/EmptyAvatar.png":p(F(i.modelValue.imageUrl)));function R(){_.value=!1,localStorage.removeItem("token"),localStorage.removeItem("user"),v("logout"),f.push("/login")}return(c,l)=>{const h=o("v-btn"),ot=o("v-img"),at=o("v-avatar"),nt=o("v-file-input"),Y=o("v-col"),z=o("v-icon"),P=o("v-list-item-title"),B=o("v-list-item-subtitle"),H=o("v-list-item"),st=o("v-list"),W=o("v-text-field"),it=o("v-form"),rt=o("v-row"),Z=o("v-card-text"),tt=o("v-card"),ct=o("v-card-title"),ut=o("v-spacer"),dt=o("v-card-actions"),mt=o("v-dialog");return u(),x(I,null,[!U(n)&&!s.value?(u(),x("div",yt,[d("div",ht,[t(h,{class:"profile-card--button font-weight-light text-none",variant:"outlined",color:"#333132","prepend-icon":"mdi-pencil",onClick:C},{default:e(()=>l[7]||(l[7]=[m(" Редактировать ")])),_:1}),t(h,{class:"profile-card--button font-weight-light text-none ml-3",color:"error",variant:"outlined","prepend-icon":"mdi-logout",onClick:l[0]||(l[0]=V=>_.value=!0)},{default:e(()=>l[8]||(l[8]=[m(" Выйти ")])),_:1})]),t(h,{class:"profile-card--button font-weight-light text-none ml-auto",color:"primary",variant:"outlined","prepend-icon":"mdi-face-agent",href:"https://t.me/babichbaker_course",target:"_blank"},{default:e(()=>l[9]||(l[9]=[m(" Связаться с поддержкой ")])),_:1})])):A("",!0),t(tt,{class:"profile--card mb-5 rounded-xm"},{default:e(()=>[t(Z,null,{default:e(()=>[t(rt,null,{default:e(()=>[t(Y,{class:j(["d-flex flex-column",{"justify-center align-center":U(n),"align-self-start":!U(n)}])},{default:e(()=>[t(at,{size:"150",class:j(["mb-2 mt-4",{"align-self-start":!U(n)}])},{default:e(()=>[t(ot,{src:L.value,alt:"Фото профиля",onError:$,fallback:"/default-avatar.jpg"},null,8,["src"])]),_:1},8,["class"]),s.value?(u(),k(nt,{key:0,label:"Изменить фото",accept:"image/*","prepend-icon":"",variant:"outlined",density:"compact","hide-details":"",class:j(["mb-2",{"w-25 h-25":U(n),"max-width-250":!U(n)}]),style:{"max-height":"50px"},"onUpdate:modelValue":E},null,8,["class"])):A("",!0)]),_:1},8,["class"]),t(Y,{cols:"12",md:"8"},{default:e(()=>[s.value?(u(),k(it,{key:1},{default:e(()=>[l[18]||(l[18]=d("div",{class:"d-flex justify-space-between align-center mb-4"},[d("div",{class:"profile-card--text"},"Редактирование профиля")],-1)),t(W,{modelValue:r.value.firstName,"onUpdate:modelValue":l[2]||(l[2]=V=>r.value.firstName=V),label:"Имя",variant:"outlined",class:"mb-1",density:"compact"},null,8,["modelValue"]),t(W,{modelValue:r.value.lastName,"onUpdate:modelValue":l[3]||(l[3]=V=>r.value.lastName=V),label:"Фамилия",variant:"outlined",class:"mb-1",density:"compact"},null,8,["modelValue"]),t(W,{modelValue:r.value.email,"onUpdate:modelValue":l[4]||(l[4]=V=>r.value.email=V),label:"Email",variant:"outlined",class:"mb-1",density:"compact",disabled:""},null,8,["modelValue"]),d("div",kt,[t(h,{class:"profile-card--button font-weight-light text-none",color:"#333132",onClick:D},{default:e(()=>l[16]||(l[16]=[m(" Сохранить ")])),_:1}),t(h,{color:"grey",variant:"outlined",onClick:q,class:"ml-2 profile-card--button font-weight-light text-none"},{default:e(()=>l[17]||(l[17]=[m(" Отмена ")])),_:1})])]),_:1})):(u(),x("div",xt,[l[15]||(l[15]=d("div",{class:"d-flex justify-space-between align-center mb-4"},[d("div",{class:"profile-card--text font-weight-light"},"Личная информация")],-1)),t(st,{color:"#FAFAFA",class:j({"pa-0 list-left-aligned":!U(n)})},{default:e(()=>[t(H,null,{prepend:e(()=>[t(z,{icon:"mdi-account"})]),default:e(()=>[t(P,{class:"font-weight-light"},{default:e(()=>l[10]||(l[10]=[m("Имя")])),_:1}),t(B,{class:"font-weight-light"},{default:e(()=>[m(g(a.modelValue.firstName),1)]),_:1})]),_:1}),t(H,null,{prepend:e(()=>[t(z,{icon:"mdi-account-outline"})]),default:e(()=>[t(P,{class:"font-weight-light"},{default:e(()=>l[11]||(l[11]=[m("Фамилия")])),_:1}),t(B,{class:"font-weight-light"},{default:e(()=>[m(g(a.modelValue.lastName),1)]),_:1})]),_:1}),t(H,null,{prepend:e(()=>[t(z,{icon:"mdi-email"})]),default:e(()=>[t(P,{class:"font-weight-light"},{default:e(()=>l[12]||(l[12]=[m("Email")])),_:1}),t(B,{class:"font-weight-light"},{default:e(()=>[m(g(a.modelValue.email),1)]),_:1})]),_:1})]),_:1},8,["class"]),U(n)?(u(),x("div",wt,[t(h,{class:"profile-card--button font-weight-light text-none",color:"#31331","prepend-icon":"mdi-pencil",variant:"outlined",onClick:C},{default:e(()=>l[13]||(l[13]=[m(" Редактировать ")])),_:1}),t(h,{class:"profile-card--button font-weight-light text-none ml-2",color:"error",variant:"outlined","prepend-icon":"mdi-logout",onClick:l[1]||(l[1]=V=>_.value=!0)},{default:e(()=>l[14]||(l[14]=[m(" Выйти ")])),_:1})])):A("",!0)]))]),_:1})]),_:1})]),_:1})]),_:1}),t(mt,{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=V=>_.value=V),"max-width":"400"},{default:e(()=>[t(tt,null,{default:e(()=>[t(ct,null,{default:e(()=>l[19]||(l[19]=[m("Подтверждение")])),_:1}),t(Z,{class:"font-weight-light"},{default:e(()=>l[20]||(l[20]=[m("Вы действительно хотите выйти из аккаунта?")])),_:1}),t(dt,null,{default:e(()=>[t(ut),t(h,{class:"profile-card--button font-weight-light text-none",variant:"outlined",text:"",onClick:l[5]||(l[5]=V=>_.value=!1)},{default:e(()=>l[21]||(l[21]=[m("Отмена")])),_:1}),t(h,{variant:"outlined",class:"profile-card--button font-weight-light text-none",color:"error",text:"",onClick:R},{default:e(()=>l[22]||(l[22]=[m("Выйти")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},$t=N(Vt,[["__scopeId","data-v-69613757"]]),Ct={class:"position-relative"},Ut={class:"text-caption text-truncate-2 course-description"},St={__name:"CourseCard",props:{course:{type:Object,required:!0}},setup(a){return(b,n)=>{const f=o("v-img"),i=o("v-card-title"),v=o("v-card-text"),s=o("v-btn"),r=o("v-card-actions"),_=o("v-card");return u(),k(_,{rounded:"lg",elevation:"1",class:"cabinet-card d-flex flex-column overflow-x"},{default:e(()=>[d("div",Ct,[t(f,{src:a.course.imageUrl,height:"250",cover:"",class:"rounded-t-lg",alt:a.course.title},null,8,["src","alt"])]),t(i,{class:"text-truncate"},{default:e(()=>[m(g(a.course.title),1)]),_:1}),t(v,{class:"py-1"},{default:e(()=>[n[0]||(n[0]=d("div",{class:"d-flex align-center mb-2"},null,-1)),d("div",Ut,g(a.course.description),1)]),_:1}),t(r,{class:"mt-auto"},{default:e(()=>[t(s,{variant:"flat",block:"",class:"card-btn-text text-none font-weight-regular w-50",color:"#333132","prepend-icon":"mdi-play",to:`/course/${a.course.id}`},{default:e(()=>[m(g(a.course.progress>0?"Продолжить":"Приступить"),1)]),_:1},8,["to"])]),_:1})]),_:1})}}},At=N(St,[["__scopeId","data-v-026995e5"]]),Nt={class:"filter-tabs mb-4"},jt={class:"flexible-filter-tabs"},It={__name:"CourseFilterTabs",props:{modelValue:{type:String,required:!0},options:{type:Array,required:!0}},emits:["update:modelValue"],setup(a){return(b,n)=>{const f=o("v-btn");return u(),x("div",Nt,[d("div",jt,[(u(!0),x(I,null,X(a.options,i=>(u(),k(f,{key:i.value,class:j(["filter-tab-btn font-weight-light",{"active-tab":a.modelValue===i.value}]),variant:"outlined",onClick:v=>b.$emit("update:modelValue",i.value)},{default:e(()=>[m(g(i.label),1)]),_:2},1032,["class","onClick"]))),128))])])}}},Tt=N(It,[["__scopeId","data-v-90bdc0d0"]]),Dt={class:"mb-2"},Ft={class:"mb-6 text-grey"},Et={key:0,class:"tooltip-wrapper"},qt={__name:"EmptyState",props:{icon:{type:String,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},actionText:{type:String,default:""},actionRoute:{type:String,default:""},actionColor:{type:String,default:"#333132"}},setup(a){return(b,n)=>{const f=o("v-icon"),i=o("v-tooltip"),v=o("v-btn"),s=o("v-card");return u(),k(s,{rounded:"lg",elevation:"1",class:"empty-card d-flex flex-column align-center justify-center"},{default:e(()=>[t(f,{icon:a.icon,size:"64",color:"grey-lighten-1",class:"mb-4"},null,8,["icon"]),d("div",Dt,g(a.title),1),d("div",Ft,g(a.description),1),a.actionText?(u(),x("div",Et,[t(i,{location:"bottom",text:"Скоро будет доступно"},{activator:e(({props:r})=>[d("div",vt(r,{class:"w-100 h-100 position-absolute"}),null,16)]),_:1}),t(v,{class:"font-weight-light text-none",color:a.actionColor,to:a.actionRoute,disabled:""},{default:e(()=>[m(g(a.actionText),1)]),_:1},8,["color","to"])])):A("",!0)]),_:1})}}},lt=N(qt,[["__scopeId","data-v-1e1fa705"]]),Ot={class:"mb-8"},Lt={class:"d-flex justify-space-between align-center mb-4"},Rt={class:"font-weight-regular"},zt={key:2,class:"text-center py-8 mt-0 pt-0 font-weight-light"},Pt={__name:"index",props:{title:{type:String,default:"Мои курсы"},courses:{type:Array,required:!0},filterValue:{type:String,required:!0},filterOptions:{type:Array,required:!0},emptyState:{type:Object,default:()=>({icon:"mdi-school-outline",title:"У вас пока нет курсов",description:"Вы можете найти интересные курсы в нашем каталоге",actionText:"Перейти в каталог",actionRoute:"/catalog",actionDisabled:{type:Boolean,default:!1}})}},emits:["update:filter-value"],setup(a,{emit:b}){const n=a,f=b,i=w(n.filterValue);M(()=>n.filterValue,s=>{i.value=s}),M(i,s=>{f("update:filter-value",s)});const v=Q(()=>{switch(i.value){case"not-started":return n.courses.filter(s=>s.progress===0);case"in-progress":return n.courses.filter(s=>s.progress>0&&s.progress<100);case"completed":return n.courses.filter(s=>s.progress===100);default:return n.courses}});return(s,r)=>{const _=o("v-col"),S=o("v-row");return u(),x("div",Ot,[d("div",Lt,[d("h2",Rt,g(a.title),1)]),a.filterOptions&&a.filterOptions.length?(u(),k(Tt,{key:0,modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=$=>i.value=$),options:a.filterOptions},null,8,["modelValue","options"])):A("",!0),v.value.length>0?(u(),k(S,{key:1},{default:e(()=>[(u(!0),x(I,null,X(v.value,$=>(u(),k(_,{key:$.id,cols:"12",sm:"6",lg:"3"},{default:e(()=>[t(At,{course:$},null,8,["course"])]),_:2},1024))),128))]),_:1})):(u(),x("div",zt,[t(lt,{icon:a.emptyState.icon,title:a.emptyState.title,description:a.emptyState.description,"action-text":a.emptyState.actionText,"action-route":a.emptyState.actionRoute},null,8,["icon","title","description","action-text","action-route"])]))])}}},Bt={class:"position-relative"},Ht={class:"d-flex align-center mb-2"},Wt={class:"font-weight-light"},Gt={class:"text-caption"},Mt={__name:"CertificateCard",props:{certificate:{type:Object,required:!0}},emits:["download","open"],setup(a){return(b,n)=>{const f=o("v-img"),i=o("v-card-title"),v=o("v-icon"),s=o("v-card-text"),r=o("v-btn"),_=o("v-card-actions"),S=o("v-card");return u(),k(S,{rounded:"lg",elevation:"1",class:"cabinet-card d-flex flex-column overflow-x"},{default:e(()=>[d("div",Bt,[t(f,{src:a.certificate.image,height:"250",cover:"",class:"rounded-t-lg bg-grey-lighten-4",alt:`Сертификат: ${a.certificate.courseName}`},null,8,["src","alt"]),n[1]||(n[1]=d("div",{class:"certificate-badge"},null,-1))]),t(i,{class:"text-truncate"},{default:e(()=>[m(g(a.certificate.courseName),1)]),_:1}),t(s,{class:"py-1"},{default:e(()=>[d("div",Ht,[t(v,{icon:"mdi-calendar",size:"small",class:"mr-1"}),d("span",Wt,"Выдан: "+g(a.certificate.issueDate),1)]),d("div",Gt,[t(v,{icon:"mdi-certificate",size:"small",class:"mr-1"}),n[2]||(n[2]=d("span",null,"Профессиональный сертификат",-1))])]),_:1}),t(_,{class:"mt-auto d-flex align-center justify-center ml-2 mr-2"},{default:e(()=>[t(r,{color:"#333132",variant:"outlined","prepend-icon":"mdi-download",class:"card-btn-text text-none font-weight-regular w-100",onClick:n[0]||(n[0]=$=>b.$emit("download",a.certificate.id))},{default:e(()=>n[3]||(n[3]=[m(" Скачать ")])),_:1})]),_:1})]),_:1})}}},Jt=N(Mt,[["__scopeId","data-v-e3097342"]]),Kt={class:"d-flex justify-space-between align-center mb-8"},Qt={class:"font-weight-regular"},Xt={__name:"index",props:{title:{type:String,default:"Мои сертификаты"},certificates:{type:Array,required:!0},emptyState:{type:Object,default:()=>({icon:"mdi-certificate-outline",title:"У вас пока нет сертификатов",description:"Завершите курс, чтобы получить сертификат"})}},setup(a){const b=f=>{console.log("Скачивание сертификата:",f)},n=f=>{console.log("Открытие сертификата:",f)};return(f,i)=>{const v=o("v-col"),s=o("v-row");return u(),x("div",null,[d("div",Kt,[d("h2",Qt,g(a.title),1)]),t(s,null,{default:e(()=>[(u(!0),x(I,null,X(a.certificates,r=>(u(),k(v,{key:r.id,cols:"12",sm:"6",lg:"3"},{default:e(()=>[t(Jt,{certificate:r,onDownload:b,onOpen:n},null,8,["certificate"])]),_:2},1024))),128)),a.certificates.length===0?(u(),k(v,{key:0,cols:"12",class:"text-center py-8 mt-0 pt-0 font-weight-light"},{default:e(()=>[t(lt,{icon:a.emptyState.icon,title:a.emptyState.title,description:a.emptyState.description},null,8,["icon","title","description"])]),_:1})):A("",!0)]),_:1})])}}},Yt="https://babichschool.ru:8080",Zt={__name:"Profile",setup(a){const{mdAndDown:b}=et(),n=w("all"),f=w(!1),i=w({firstName:"",lastName:"",email:"",imageUrl:""}),v=()=>K.getToken(),s=w([]);async function r(){try{if(f.value=!0,!K.getToken()){s.value=[];return}const C=await _t();s.value=C.map(y=>({id:y.id,title:y.title,imageUrl:y.imageUrl||"/public/main--menu3.png",progress:y.progress||0,lessonsCompleted:y.lessonsCompleted||0,totalLessons:y.totalLessons||0,certificateAvailable:y.certificateAvailable||!1}))}catch(p){console.error("Ошибка при получении курсов пользователя:",p),s.value=[]}finally{f.value=!1}}async function _(){try{f.value=!0;const p=await J.get(`${Yt}/users/me`,{headers:{Authorization:`Bearer ${v()}`}});i.value={firstName:p.data.firstName||"",lastName:p.data.lastName||"",email:p.data.email||"",imageUrl:p.data.imageUrl||"/EmptyAvatar.png"}}catch(p){console.error("Ошибка при получении данных пользователя:",p)}finally{f.value=!1}}pt(()=>{_(),r()});const S=w("");function $(){i.value={firstName:"",lastName:"",email:"",imageUrl:""},localStorage.removeItem("jwt_token")}const D=[{value:"all",label:"Все курсы"},{value:"not-started",label:"Не начатые"},{value:"in-progress",label:"В процессе"},{value:"completed",label:"Завершенные"}],F=Q(()=>{let p="";switch(n.value){case"not-started":p="У вас нет не начатых курсов";break;case"in-progress":p="У вас нет курсов в процессе";break;case"completed":p="У вас нет завершенных курсов";break;default:p="У вас пока нет курсов"}return{icon:"mdi-book-outline",title:p,description:"Выберите другой фильтр или перейдите в каталог",actionText:"Перейти в каталог",actionRoute:"/catalog"}});return(p,C)=>{const y=o("v-col"),T=o("v-row"),E=o("v-progress-circular"),q=o("v-overlay"),O=o("v-container"),L=o("v-main"),R=o("v-app");return u(),x(I,null,[t(gt),t(R,null,{default:e(()=>[t(L,null,{default:e(()=>[t(O,{width:U(b)?"100vw":"60vw"},{default:e(()=>[t(T,{class:"mb-2"},{default:e(()=>[t(y,{cols:"12"},{default:e(()=>C[1]||(C[1]=[d("h1",{class:"font-weight-medium mt-4"},"Личный кабинет",-1)])),_:1})]),_:1}),t(q,{"model-value":f.value,contained:"",class:"align-center justify-center"},{default:e(()=>[t(E,{indeterminate:"",size:"64"})]),_:1},8,["model-value"]),t($t,{modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=c=>i.value=c),class:"mb-8",onLogout:$},null,8,["modelValue"]),t(Pt,{courses:s.value,"filter-value":n.value,"filter-options":D,"empty-state":F.value},null,8,["courses","filter-value","empty-state"]),t(Xt,{certificates:S.value},null,8,["certificates"])]),_:1},8,["width"]),t(bt)]),_:1})]),_:1})],64)}}},le=N(Zt,[["__scopeId","data-v-f5d0d8d9"]]);export{le as default};
