import{d as R,u as j,g,h as x,x as h,o as S,c as q,a as n,w as p,b as z,e as f,f as v,s as F,t as G,v as K,y as M,p as W,m as H,r as d,A as w,_ as J}from"./index-r6CkWk_M.js";import{A as O,_ as Q}from"./AuthMobileImage.vue_vue_type_script_setup_true_lang-grwX-Oq-.js";const X={class:"page-container"},Y=R({__name:"LoginPage",setup(Z){const{mdAndDown:D,smAndUp:_}=j(),c=H(),m=g(!1),u=g(!1),l=g(""),y=x({get:()=>o.password,set:t=>{o.password=t.replace(/\s+/g,""),r.password=""}}),k=t=>{(t.key===" "||t.key==="Spacebar")&&t.preventDefault()},V=t=>{t.preventDefault();const a=(t.clipboardData||window.clipboardData).getData("text").replace(/\s+/g,"");o.password=a,r.password=""},o=h({password:"",email:""}),r=h({password:"",email:""}),A=()=>{c.push("/register")},I=()=>{let t=!0;return o.email.trim()||(r.email="Введите email",t=!1),o.password||(r.password="Введите пароль",t=!1),t},C=t=>{try{return localStorage.getItem(t)}catch(e){return console.error("Error accessing localStorage:",e),null}},E=(t,e)=>{try{localStorage.setItem(t,e)}catch(s){console.error("Error writing to localStorage:",s)}},B=t=>{try{localStorage.removeItem(t)}catch(e){console.error("Error removing from localStorage:",e)}},L=async()=>{var t,e;if(I())try{u.value=!0,l.value="",r.email="",r.password="";const s=await w.login(o.email,o.password),a=C("redirectAfterLogin");B("redirectAfterLogin"),a?a.includes("/admin")&&!w.isAdmin()?(c.push("/profile"),E("accessError","Доступ к административной панели запрещен")):c.push(a):w.isAdmin()?c.push("/admin"):c.push("/profile")}catch(s){if(s.response){if(s.response.status===401)l.value="Неверный логин или пароль";else if(s.response.status===403)l.value="Доступ запрещен";else if((t=s.response.data)!=null&&t.message)l.value=s.response.data.message;else if((e=s.response.data)!=null&&e.errors){const a=s.response.data.errors;a.email&&(r.email=a.email),a.password&&(r.password=a.password)}else l.value=`Ошибка сервера: ${s.response.status}`;console.error("Ошибка сервера:",s.response.data)}else s.request?(l.value="Не удалось связаться с сервером. Проверьте подключение к интернету.",console.error("Ошибка запроса:",s.request)):(l.value=`Произошла ошибка: ${s.message}`,console.error("Ошибка:",s.message))}finally{u.value=!1}},T=x(()=>!o.email||!o.password||u.value);return(t,e)=>{const s=d("v-card-title"),a=d("v-text-field"),$=d("router-link"),N=d("v-card-text"),P=d("v-alert"),b=d("v-btn"),U=d("v-container");return S(),q("div",X,[n(O),n(U,{class:"main-container"},{default:p(()=>[z("form",{onSubmit:M(L,["prevent"]),class:W(["align-md-center d-flex flex-column",v(D)?"w-66":"w-50"])},[n(Q),n(s,{class:"align-md-center justify-center d-flex pl-0 mb-3 font-weight-regular"},{default:p(()=>e[6]||(e[6]=[f(" Вход ")])),_:1}),n(a,{class:"w-100 font-weight-light",modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=i=>o.email=i),label:"Логин",variant:"outlined",density:v(_)?"comfortable":"compact","error-messages":r.email,onInput:e[1]||(e[1]=i=>{r.email="",i.target.value=i.target.value.replace(/\s/g,"")})},null,8,["modelValue","density","error-messages"]),n(a,{class:"w-100 mb-0 font-weight-light",label:"Пароль",density:v(_)?"comfortable":"compact",variant:"outlined","append-inner-icon":m.value?"mdi-eye-off":"mdi-eye",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=i=>y.value=i),type:m.value?"text":"password","onClick:appendInner":e[3]||(e[3]=i=>m.value=!m.value),"error-messages":r.password,onPaste:V,onKeydown:k},null,8,["density","append-inner-icon","modelValue","type","error-messages"]),n(N,{class:"w-100 justify-center d-flex mt-0 pt-0 pl-0 font-weight-light"},{default:p(()=>[e[8]||(e[8]=f(" Забыли пароль?   ")),n($,{to:"reset-password"},{default:p(()=>e[7]||(e[7]=[f(" Восстановить ")])),_:1})]),_:1}),l.value?(S(),F(P,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-3 w-100 font-weight-light","onClick:close":e[4]||(e[4]=i=>l.value="")},{default:p(()=>[f(G(l.value),1)]),_:1})):K("",!0),n(b,{class:"text-none mb-2 w-100 font-weight-thin",type:"submit",text:"Войти",loading:u.value,disabled:T.value,flat:""},null,8,["loading","disabled"]),n(b,{class:"text-none mb-2 w-100 font-weight-thin",text:"Создать аккаунт",onClick:e[5]||(e[5]=i=>A()),flat:""})],34)]),_:1})])}}}),se=J(Y,[["__scopeId","data-v-3497adf7"]]);export{se as default};
