import{H as G}from"./Header-D6UShxcF.js";import{d as E,u as N,b as y,k as n,o as a,l as P,w as o,e as s,f,t as r,c as i,n as R,m as z,h as x,_ as A,r as c,p as B,g as h,F as W,y as J,q as K,j as Q,H as X}from"./index-_IANILbF.js";import{c as Y}from"./courseUserService-CDlgJdbB.js";const Z={class:"pa-4"},ee={class:"card-text d-flex flex-wrap"},te={class:"font-weight-bold mr-1"},se={class:"font-weight-light"},oe=E({__name:"LessonCard",props:{courseData:{type:Object,required:!0}},emits:["click"],setup(l){const{mdAndDown:g}=N(),d=l,C=y(()=>{switch(d.courseData.progress){case"IN_PROGRESS":return"В процессе";case"COMPLETED":return"Завершено";default:return"Не начато"}}),u=y(()=>{switch(d.courseData.progress){case"IN_PROGRESS":return"progress-in-progress";case"COMPLETED":return"progress-completed";default:return"progress-not-started"}});return(k,p)=>{const w=n("v-img"),D=n("v-card");return a(),P(D,{onClick:p[0]||(p[0]=$=>k.$emit("click",l.courseData.id)),class:"course-lessons rounded-lg",width:x(g)?"50vw":"30vw",elevation:"1"},{default:o(()=>[s(w,{src:l.courseData.imagePath,class:"responsive-image rounded-t","aspect-ratio":16/9,cover:""},null,8,["src"]),f("div",Z,[f("div",ee,[f("span",te,r(l.courseData.number)+" /",1),f("span",se,r(l.courseData.title),1)]),l.courseData.progress?(a(),i("div",{key:0,class:R(["progress-badge mt-2",u.value])},r(C.value),3)):z("",!0)])]),_:1},8,["width"])}}}),ae=A(oe,[["__scopeId","data-v-cf0bf002"]]),re={class:"page-wrapper"},ce={class:"mt-5 font-weight-medium"},ne={class:"mb-2 font-weight-regular"},le={key:0,class:"breadcrumbs-container"},ue={key:1,class:"back-button-container pt-4 pb-2 pl-0 ml-0"},ie={key:0,class:"text-center w-100"},de={key:1,class:"text-center w-100 red--text"},pe=E({__name:"CourseLessons",setup(l){const{mdAndDown:g}=N(),d=K(),C=Q(),u=y(()=>d.params.courseId),k=y(()=>d.params.blocksId),p=c(""),w=c([]),D=c("Авторский курс от Максима Бабича"),$=c("1"),I=c(""),b=c(!0),v=c(""),T=c([]),L=e=>{if(!e)return"/public/default-lesson.jpg";let t=e.replace(/https:\/\/https:\/\//g,"https://");return t=t.replace(/https:\/\/https\//g,"https://"),t},O=async e=>{if(e){b.value=!0,v.value="";try{const t=await Y.fetchCourseWithBlocks(e);p.value=t.courseTitle||"Курс без названия",w.value=t.blocks||[]}catch(t){console.error("Ошибка при загрузке курса:",t),v.value="Не удалось загрузить данные курса. Пожалуйста, попробуйте позже.",w.value=[]}finally{b.value=!1}}};B(()=>{const e=d.params.courseId;e&&(u.value=e,O(e))});const U=async()=>{b.value=!0,v.value="";try{const e=await X(k.value);I.value=e.blockTitle,T.value=e.lessons}catch(e){v.value="Не удалось загрузить данные уроков",console.error(e)}finally{b.value=!1}},F=(e,t)=>{if(t){const m=L(t);console.log(`Сохраняем изображение урока ${e}:`,m),localStorage.setItem(`lesson_image_${e}`,m)}C.push(`/course/${u.value}/blocks/${k.value}/lessons/${e}`)};return B(()=>{U()}),(e,t)=>{const m=n("v-breadcrumbs-item"),V=n("v-breadcrumbs"),j=n("v-btn"),H=n("v-card-title"),M=n("v-progress-circular"),S=n("v-container");return a(),i("div",re,[s(G),s(S,{width:x(g)?"100vw":"80vw"},{default:o(()=>[f("h2",ce,r(p.value),1),f("h3",ne,r(D.value),1),x(g)?(a(),i("div",ue,[s(j,{variant:"outlined",density:"comfortable",to:`/course/${u.value}`,class:"back-button text-none"},{default:o(()=>t[2]||(t[2]=[h(" К блокам ")])),_:1},8,["to"])])):(a(),i("div",le,[s(V,{class:"mb-1 pl-0 font-weight-light",color:"#F48A21"},{default:o(()=>[s(m,{to:"/lk"},{default:o(()=>t[0]||(t[0]=[h("Профиль")])),_:1}),s(m,{to:`/course/${u.value}`},{default:o(()=>[h(r(p.value),1)]),_:1},8,["to"]),s(m,{disabled:"",to:`/course/${u.value}/blocks`},{default:o(()=>t[1]||(t[1]=[h("Уроки")])),_:1},8,["to"])]),_:1})])),s(H,{class:"course-title font-weight-bold pt-0 pl-0",style:{color:"#333132"}},{default:o(()=>[h(" Блок "+r($.value)+" / "+r(I.value),1)]),_:1}),s(S,{class:R(x(g)?"d-flex flex-row flex-wrap ga-5 ml-0 pl-0 mr-0 pr-0":"d-flex flex-row flex-wrap ga-5 ml-0 pl-0 align-center")},{default:o(()=>[b.value?(a(),i("div",ie,[s(M,{indeterminate:"",color:"#F48A21"})])):v.value?(a(),i("div",de,r(v.value),1)):(a(!0),i(W,{key:2},J(T.value,(_,q)=>(a(),P(ae,{key:_.lessonId,"course-data":{id:_.lessonId,number:String(q+1).padStart(2,"0"),title:_.lessonTitle,imagePath:L(_.imageUrl)},onClick:ve=>F(_.lessonId,_.imageUrl)},null,8,["course-data","onClick"]))),128))]),_:1},8,["class"])]),_:1},8,["width"])])}}}),ge=A(pe,[["__scopeId","data-v-416c02ab"]]);export{ge as default};
