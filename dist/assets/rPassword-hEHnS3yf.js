import{d as E,u as K,g as u,x as g,i as R,h as x,o as C,c as W,a as r,w as y,b as j,e as V,f as b,s as q,t as L,v as Z,y as F,p as G,m as H,z as J,r as m,A as O,_ as Q}from"./index-r6CkWk_M.js";import{A as X,_ as Y}from"./AuthMobileImage.vue_vue_type_script_setup_true_lang-grwX-Oq-.js";const ee={class:"page-container"},se=E({__name:"rPassword",setup(te){const{mdAndDown:S,smAndUp:_}=K(),T=H(),A=J(),f=u(!1),w=u(!1),i=u(""),v=u(!1),p=u(""),s=g({password:"",confirmPassword:""}),n=g({password:""}),a=g({text:"",type:"info"});R(()=>{var e;p.value=((e=A.query.token)==null?void 0:e.toString())||"",p.value||(a.text="Ссылка недействительна. Запросите восстановление пароля заново.",a.type="error")});const P=x({get:()=>s.password,set:e=>{s.password=e.replace(/\s+/g,""),n.password=""}}),D=x({get:()=>s.confirmPassword,set:e=>{s.confirmPassword=e.replace(/\s+/g,""),c()}}),h=e=>{(e.key===" "||e.key==="Spacebar")&&e.preventDefault()},I=e=>{e.preventDefault();const o=(e.clipboardData||window.clipboardData).getData("text").replace(/\s+/g,"");s.password=o,n.password=""},B=e=>{e.preventDefault();const o=(e.clipboardData||window.clipboardData).getData("text").replace(/\s+/g,"");s.confirmPassword=o,c()},k=()=>{if(n.password="",!!s.password){if(s.password.length<8){n.password="Пароль должен содержать не менее 8 символов";return}if(!/[a-zA-Z]/.test(s.password)){n.password="Пароль должен содержать латинские буквы";return}if(!/\d/.test(s.password)){n.password="Пароль должен содержать цифры";return}if(!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(s.password)){n.password="Пароль должен содержать специальные символы";return}c()}},c=()=>{s.confirmPassword&&s.password!==s.confirmPassword?i.value="Пароли не совпадают":i.value=""},$=async()=>{var e,t,l;if(!p.value){a.text="Отсутствует токен для сброса пароля. Запросите восстановление пароля заново.",a.type="error";return}if(k(),c(),!(n.password||i.value)){v.value=!0,a.text="";try{await O.resetPassword(p.value,s.password),a.text="Пароль успешно изменен!",a.type="success",setTimeout(()=>{T.push("/login")},2e3)}catch(o){console.error("Ошибка при изменении пароля:",o),((e=o.response)==null?void 0:e.status)===400?a.text="Ссылка для восстановления пароля недействительна или срок её действия истек.":(l=(t=o.response)==null?void 0:t.data)!=null&&l.message?a.text=o.response.data.message:a.text="Произошла ошибка при смене пароля. Попробуйте запросить новую ссылку.",a.type="error"}finally{v.value=!1}}},M=x(()=>!s.password||!s.confirmPassword||s.password!==s.confirmPassword||!!n.password||!!i.value||!p.value||v.value);return(e,t)=>{const l=m("v-card-title"),o=m("v-text-field"),N=m("v-alert"),z=m("v-btn"),U=m("v-container");return C(),W("div",ee,[r(X),r(U,{class:"main-container"},{default:y(()=>[j("form",{onSubmit:F($,["prevent"]),class:G(["align-md-center d-flex flex-column",b(S)?"w-66":"w-50"])},[r(Y),r(l,{class:"align-md-center justify-center d-flex pl-0 pb-0 mb-3 font-weight-regular"},{default:y(()=>t[5]||(t[5]=[V(" Установка нового пароля ")])),_:1}),r(o,{class:"w-100 mb-0 font-weight-light",label:"Новый пароль",hint:"Не менее 8 знаков: латинские буквы, цифры, спецсимволы","persistent-hint":"",density:b(_)?"comfortable":"compact",variant:"outlined","append-inner-icon":f.value?"mdi-eye-off":"mdi-eye",modelValue:P.value,"onUpdate:modelValue":t[0]||(t[0]=d=>P.value=d),type:f.value?"text":"password","onClick:appendInner":t[1]||(t[1]=d=>f.value=!f.value),"error-messages":n.password,onInput:k,onKeydown:h,onPaste:I},null,8,["density","append-inner-icon","modelValue","type","error-messages"]),r(o,{class:"w-100 mb-3 font-weight-light mt-3",label:"Повторите пароль",variant:"outlined",density:b(_)?"comfortable":"compact","append-inner-icon":w.value?"mdi-eye-off":"mdi-eye",modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=d=>D.value=d),type:w.value?"text":"password","onClick:appendInner":t[3]||(t[3]=d=>w.value=!w.value),"error-messages":i.value,onInput:c,onKeydown:h,onPaste:B},null,8,["density","append-inner-icon","modelValue","type","error-messages"]),a.text?(C(),q(N,{key:0,type:a.type,variant:"tonal",closable:"",class:"mb-3 w-100","onClick:close":t[4]||(t[4]=d=>a.text="")},{default:y(()=>[V(L(a.text),1)]),_:1},8,["type"])):Z("",!0),r(z,{class:"text-none mb-2 w-100 font-weight-thin",type:"submit",text:"Сохранить новый пароль",disabled:M.value,loading:v.value,flat:""},null,8,["disabled","loading"])],34)]),_:1})])}}}),ne=Q(se,[["__scopeId","data-v-227a798f"]]);export{ne as default};
